---
type: docs
url: "hub/docs/folder/CIPipeline"
---

# GitLab CI/CD Overview

Continuous Integration (CI) is a way to automatically test, build, and validate your code whenever changes are made.

**GitLab** provides built-in CI/CD features through its `.gitlab-ci.yml` file. This file, placed in the root of your repository, tells GitLab how to build and test your project. It defines stages and scripts that are run in a clean environment every time changes are pushed.

This document outlines how GitLab CI/CD works, including the role of the `.gitlab-ci.yml` file, shell scripts, and external tools like Meson and Ninja.

## GitLab CI/CD Basics

The CI is controlled by a file named `.gitlab-ci.yml`. This file defines:

- **Stages**: Ordered groups of jobs (e.g., `build-this`, `build-that`, `package-up`)
- **Jobs**: Individual tasks to run within each stage
- **Scripts**: Shell commands executed for each job
- **Runners**: Computers that GitLab uses to run jobs defined in the pipeline.

## Container-Based Builds

The Artbox pipeline uses containerization for consistent builds:

1. **Creating the Build Container**: The first stage uses Kaniko to create a Docker image with all dependencies
2. **Using the Container**: Subsequent stages run inside this container, ensuring consistent environment

This approach ensures that builds work the same way across any GitLab runner.

## Role of Shell Scripts

Jobs in `.gitlab-ci.yml` typically invoke shell commands directly. Complex operations are often moved into separate scripts stored in the repository.

An example of a shell script being called in a yaml file
```
script:
  - ./build/linux/appimage/artbox-goappimage.sh
```

This keeps the `.gitlab-ci.yml` file clean and makes build logic easier to maintain.

## Integration with Build Systems

Artbox uses **Meson** and **Ninja** to prepare and then build the code.

For example:

```
script:
  - meson setup _build-${CI_RUNNER_TAG}
  - ninja -C _build-${CI_RUNNER_TAG}
```

Here:

- `meson setup` prepares the build directory and generates `build.ninja`
- `ninja` runs the build commands as defined

## Meson Build System Structure

The **Meson** build system uses a root `meson.build` file placed at the project’s root directory. This file defines the top-level build configuration and entry point for the build process.

- The root `meson.build` is typically located in the same directory as `.gitlab-ci.yml`
- From there, it **cascades recursively** into subdirectories, each of which may have its own `meson.build` file
- These subdirectory files define targets, sources, dependencies, and build instructions relevant to that directory

## Environment Variables

Key variables in the Artbox pipeline include:

```yaml
variables:
  COMPILER: "clang"   # Compiler selection
  GIMP_PREFIX: "${CI_PROJECT_DIR}/_install-${CI_RUNNER_TAG}"  # Installation path
  MESON_OPTIONS: "-Drelocatable=yes -Dvector-icons=true"  # Build configuration
```

## Example Structure

```
project-root/
├── .gitlab-ci.yml
├── meson.build              <-- Root Meson file
├── src/
│   ├── meson.build          <-- Subdirectory Meson file
│   └── some_source.c
├── data/
│   ├── meson.build
│   └── icons/
```

In this structure:

- The root `meson.build` file configures the overall build environment
- Subdirectory `meson.build` files handle compilation details for specific components or modules
- This hierarchical layout keeps build logic modular and maintainable

## Artifacts Between Stages

Artifacts are files generated by jobs that are needed in subsequent stages:

```yaml
build-artbox:
  # ...job configuration...
  artifacts:
    paths:
      - "${GIMP_PREFIX}/"      # Installation files
      - _build-${CI_RUNNER_TAG}/meson-logs/meson-log.txt  # Build logs
```

## Pipeline Stages and Dependencies

The Artbox pipeline consists of three key stages:

1. **Environment Preparation**: Creates a containerized build environment using Kaniko, including all dependencies and pre-building babl and GEGL libraries
2. **Application Build**: Compiles Artbox using Meson and Ninja in the prepared environment
3. **Packaging**: Creates a distributable AppImage for end users

Each stage runs only after the previous one completes successfully.

## Summary

- `.gitlab-ci.yml` defines the structure and logic of the pipeline
- Jobs contain shell commands or external scripts
- Tools like Meson and Ninja are used inside jobs as part of the build process

Artbox uses the GitLab CI to automatically build it's AppImage for Debian based platforms. Here is the Artbox [.gitlab-ci.yml](https://gitlab.gnome.org/pixelmixer/artbox/-/ci/editor?branch_name=artbox) to view.
